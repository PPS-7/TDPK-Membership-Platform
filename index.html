<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TDPK Member Pass – GitHub Pages Demo</title>
  <meta name="description" content="TDPK Member Pass demo (no build tools). React + Supabase on a single HTML file." />

  <!-- Base styles (clean, dark, responsive) -->
  <style>
    :root{
      --bg:#0f1115; --bg2:#121623; --card:#151a28; --border:#22293d;
      --text:#eef1ff; --muted:#9aa4c1; --primary:#6ca8ff; --secondary:#a78bfa;
      --ok:#9be28f; --warn:#ffd28f; --danger:#ff9aa7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans";
      background: radial-gradient(1200px 800px at 10% -10%, #1b2237 0, transparent 60%),
                  radial-gradient(900px 600px at 100% 0%, #181d30 0, transparent 60%),
                  linear-gradient(180deg, var(--bg), #0d101a 40%, #0b0e16 100%);
      color:var(--text);
    }
    a{ color:var(--primary); text-decoration:none }
    .container{ max-width:1100px; margin:0 auto; padding:24px }
    .header{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:18px }
    .brand{ font-weight:700; letter-spacing:.3px }
    nav a{ margin-right:12px }
    .card{ background:var(--card); border:1px solid var(--border); border-radius:14px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.25) }
    .muted{ color:var(--muted) }
    .btn{ border:1px solid var(--border); background:#14182a; color:var(--text); padding:10px 14px; border-radius:10px; cursor:pointer }
    .btn.primary{ background: linear-gradient(90deg, #2563eb, #0891b2); border-color: transparent; }
    .btn.warn{ background:#332610; border-color:#5e4b1a }
    .btn.block{ width:100% }
    .grid{ display:grid; gap:16px }
    @media(min-width: 900px){ .grid.cols-2{ grid-template-columns:repeat(2, 1fr)} .grid.cols-3{ grid-template-columns:repeat(3, 1fr)} }
    .label{ font-size:12px; color:var(--muted); margin:8px 0 6px }
    .input{ width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:#0f1424; color:var(--text) }
    .badge{ display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:999px; font-size:12px; margin-right:8px }
    .ok{ color:var(--ok) } .warn{ color:var(--warn) } .danger{ color:var(--danger) }
    .qr{ font-family:monospace; background:#0c1222; border:1px dashed var(--border); padding:12px; border-radius:10px; overflow:auto }
    footer{ color:#7e86a3; text-align:center; padding:32px 16px }
    .heroTitle{ font-size:44px; font-weight:800; background:linear-gradient(90deg,#6ca8ff,#a78bfa); -webkit-background-clip:text; background-clip:text; color:transparent }
    .pill{ display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:#121629 }
    .hidden{ display:none !important }
  </style>

  <!-- React, ReactDOM (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Supabase (CDN) -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
</head>
<body>
  <div id="app"></div>

  <script type="text/javascript">
  ;(() => {
    const { useState, useEffect } = React;

    // -------------- EDIT THESE TWO VALUES --------------
    const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co";      // <-- change me
    const SUPABASE_ANON_KEY = "YOUR_PUBLIC_ANON_KEY_HERE";         // <-- change me
    // ---------------------------------------------------

    // Create Supabase client
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // Simple hash-router util
    function useHashRoute() {
      const [route, setRoute] = useState(location.hash.replace('#','') || '/');
      useEffect(() => {
        const onHash = () => setRoute(location.hash.replace('#','') || '/');
        window.addEventListener('hashchange', onHash);
        return () => window.removeEventListener('hashchange', onHash);
      }, []);
      function go(to){ location.hash = to.startsWith('#') ? to : ('#' + to) }
      return [route, go];
    }

    // Top-level App
    function App(){
      const [route, go] = useHashRoute();
      const [session, setSession] = useState(null);

      useEffect(() => {
        supabase.auth.getSession().then(({ data }) => setSession(data.session));
        const { data: sub } = supabase.auth.onAuthStateChange((_e, s) => setSession(s));
        return () => { sub.subscription.unsubscribe() }
      }, []);

      function logout(){
        supabase.auth.signOut().then(()=>go('/auth'));
      }

      return React.createElement('div', { className: 'container' },
        React.createElement(Header, { session, go, logout }),
        route === '/' ? React.createElement(Home, { go, supabase }) :
        route.startsWith('/auth') ? React.createElement(Auth, { go, supabase }) :
        React.createElement(Dashboard, { go, supabase, session })
      )
    }

    // Header
    function Header({ session, go, logout }){
      return React.createElement('div', { className: 'header' },
        React.createElement('div', null,
          React.createElement('div', { className:'brand' }, 'TDPK Member Pass'),
          React.createElement('div', { className:'muted' }, 'GitHub Pages Demo (React + Supabase)')
        ),
        React.createElement('nav', null,
          React.createElement('a', { href:'#/' }, 'Home'),
          React.createElement('a', { href:'#/auth' }, 'Auth'),
          React.createElement('a', { href:'#/dashboard' }, 'Dashboard'),
          session
            ? React.createElement('button', { className:'btn', onClick: logout }, 'Logout')
            : null
        )
      )
    }

    // Home / Landing
    function Home({ go, supabase }){
      const [busy, setBusy] = useState(false);
      const [msg, setMsg] = useState('');

      async function seed(){
        setBusy(true); setMsg('');
        try{
          // Calls your deployed Edge Function (must exist in Supabase)
          const { data, error } = await supabase.functions.invoke('ensure-demo-users');
          if(error) throw new Error(error.message);
          setMsg('✅ Demo users created. Go to Auth to sign in.');
        }catch(e){
          setMsg('❌ Seeding failed: ' + (e.message || e));
        }finally{
          setBusy(false);
        }
      }

      return React.createElement('div', { className:'grid cols-2' },
        React.createElement('div', { className:'card' },
          React.createElement('div', { className:'pill', style:{marginBottom:10} }, 'No build required • Works on GitHub Pages'),
          React.createElement('div', { className:'heroTitle' }, 'Work anywhere, connect everywhere.'),
          React.createElement('p', { className:'muted' }, 'A minimal, static demo of the TDPK Member Pass. Seed demo accounts, log in, and see the dashboard.'),
          React.createElement('div', { className:'grid cols-2', style:{marginTop:16} },
            React.createElement('button', { className:'btn primary', onClick: () => go('/auth') }, 'Get Started'),
            React.createElement('button', { className:'btn', onClick: seed, disabled: busy }, busy ? 'Seeding…' : 'Setup Demo Accounts')
          ),
          msg && React.createElement('div', { style:{marginTop:12} }, React.createElement('div', { className:'badge ok' }, msg))
        ),

        React.createElement('div', { className:'grid cols-1' },
          React.createElement('div', { className:'card' },
            React.createElement('h3', null, 'Configure your Supabase keys'),
            React.createElement('p', { className:'muted' },
              'Open this HTML file and replace ',
              React.createElement('code', null, 'SUPABASE_URL'), ' and ',
              React.createElement('code', null, 'SUPABASE_ANON_KEY'),
              ' at the top of the script.'
            ),
            React.createElement('p', { className:'muted' },
              'Make sure you deployed the Edge Function ',
              React.createElement('code', null, 'ensure-demo-users'),
              ' and that Email/Password auth is ON in your Supabase project.'
            )
          ),
          React.createElement('div', { className:'card' },
            React.createElement('h3', null, 'Demo Credentials'),
            React.createElement('p', { className:'muted' }, 'After seeding, try these:'),
            React.createElement('pre', { className:'qr' },
`Your Admin: pakkanan.cha@truedigitalpark.com / test1811

Admin (alt):    pete.admin@tdpk.co.th   / Demo!Admin123
Partner (SALT): takumi@salt.jp          / Demo!Partner123
Member:         alice.member@demo.com   / Demo!Member123`
            )
          )
        )
      )
    }

    // Auth page
    function Auth({ go, supabase }){
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [msg, setMsg] = useState('');
      const [busy, setBusy] = useState(false);

      async function signIn(e){
        e.preventDefault();
        setBusy(true); setMsg('');
        const { error } = await supabase.auth.signInWithPassword({ email, password });
        if(error){ setMsg('❌ ' + error.message); setBusy(false); return; }
        setMsg('✅ Signed in. Redirecting…');
        setTimeout(()=>location.hash = '#/dashboard', 400);
      }

      async function magic(){
        setBusy(true); setMsg('');
        const { error } = await supabase.auth.signInWithOtp({ email });
        setMsg(error ? ('❌ ' + error.message) : '✅ Magic link sent (check inbox).');
        setBusy(false);
      }

      function fillMyDemo(){
        setEmail('pakkanan.cha@truedigitalpark.com');
        setPassword('test1811');
      }

      return React.createElement('div', { className:'grid cols-2' },
        React.createElement('div', { className:'card' },
          React.createElement('h2', null, 'Sign in'),
          React.createElement('form', { onSubmit: signIn },
            React.createElement('div', { className:'label' }, 'Email'),
            React.createElement('input', { className:'input', value:email, onChange:e=>setEmail(e.target.value), placeholder:'you@example.com' }),
            React.createElement('div', { className:'label' }, 'Password'),
            React.createElement('input', { className:'input', type:'password', value:password, onChange:e=>setPassword(e.target.value), placeholder:'••••••••' }),
            React.createElement('div', { style:{height:12} }),
            React.createElement('button', { className:'btn primary block', disabled: busy }, busy ? 'Signing in…' : 'Sign in')
          ),
          React.createElement('div', { className:'grid cols-2', style:{marginTop:12} },
            React.createElement('button', { className:'btn', onClick: magic, disabled: busy }, 'Send magic link'),
            React.createElement('button', { className:'btn warn', onClick: fillMyDemo, disabled: busy }, 'Fill my demo admin')
          ),
          msg && React.createElement('div', { style:{marginTop:12} }, React.createElement('div', { className: msg.includes('✅') ? 'badge ok' : 'badge danger' }, msg))
        ),

        React.createElement('div', { className:'card' },
          React.createElement('h3', null, 'Tips'),
          React.createElement('ul', { className:'muted' },
            React.createElement('li', null, 'Run seeding on Home if login fails.'),
            React.createElement('li', null, 'Confirm Email/Password auth is ON in Supabase.'),
            React.createElement('li', null, 'Edge Function ',
              React.createElement('code', null, 'ensure-demo-users'),
              ' must be deployed and share the same project as this page.'
            )
          )
        )
      )
    }

    // Dashboard
    function Dashboard({ supabase, session }){
      const [profile, setProfile] = useState(null);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        (async () => {
          const { data: { user } } = await supabase.auth.getUser();
          if (!user){ setLoading(false); return; }
          // Try reading role from public.users if your RLS allows it
          let role = 'member';
          try{
            const { data } = await supabase.from('users').select('role').eq('id', user.id).maybeSingle();
            role = data?.role || 'member';
          }catch{}
          setProfile({ email: user.email, role });
          setLoading(false);
        })();
      }, []);

      if (loading) return React.createElement('div', { className:'card' }, 'Loading…');

      if (!session) {
        return React.createElement('div', { className:'card' },
          'You are not signed in. ',
          React.createElement('a', { href:'#/auth' }, 'Go to Auth')
        );
      }

      return React.createElement('div', { className:'grid cols-2' },
        React.createElement('div', { className:'card' },
          React.createElement('h2', null, 'Dashboard'),
          profile
            ? React.createElement(React.Fragment, null,
                React.createElement('div', null, 'Signed in as: ', React.createElement('strong', null, profile.email)),
                React.createElement('div', { style:{marginTop:10} },
                  React.createElement('span', { className:'badge' }, 'Role: ' + profile.role),
                  React.createElement('span', { className:'badge' }, 'Status: Active (demo)')
                ),
                React.createElement('div', { style:{marginTop:12} },
                  React.createElement('div', { className:'qr' }, 'QR: [simulated rotating token]')
                )
              )
            : 'No profile'
        ),
        React.createElement('div', { className:'card' },
          React.createElement('h3', null, 'What next?'),
          React.createElement('ul', { className:'muted' },
            React.createElement('li', null, 'Add Wallet Pass generation'),
            React.createElement('li', null, 'Add Partner “Scan & Verify” camera page'),
            React.createElement('li', null, 'Implement Offers listing and redemption logging')
          )
        )
      )
    }

    // Render app
    ReactDOM.createRoot(document.getElementById('app')).render(React.createElement(App));
  })();
  </script>

  <footer>© TDPK Demo • Static HTML on GitHub Pages</footer>
</body>
</html>
